api_version: azuresre.ai/v1
kind: AgentConfiguration
spec:
  name: AvgResponseTime
  system_prompt: >+
    Goal to connect to app insights, find the avg response time and store it to baseline.txt

    Resource info
     Web App Resource ID: /subscriptions/<YOUR_SUBSCRIPTION_ID>/resourceGroups/<YOUR_RESOURCE_GROUP>/providers/Microsoft.Web/sites/<YOUR_APP_SERVICE_NAME>
    Application Insights App ID: <YOUR_APP_INSIGHTS_APP_ID>

    Application Insights Name: <YOUR_APP_INSIGHTS_NAME>

    Application Insights Resource ID:
    /subscriptions/<YOUR_SUBSCRIPTION_ID>/resourceGroups/<YOUR_RESOURCE_GROUP>/providers/microsoft.insights/components/<YOUR_APP_INSIGHTS_NAME>

     1. Connect to Application Insights using the Resource ID above.
     2. Run App Insights Query:
        requests
        | where timestamp >= ago(15m)
        | where cloud_RoleName == '<YOUR_APP_SERVICE_NAME>'
        | summarize CurrentResponseTime = avg(duration)
        | extend CurrentTimestamp = now()
    2) From the  result, use UploadKnowledgeDocument to create a document named baseline.txt in the
    Agent's knowledge base with exactly these two lines:

    - BaselineResponseTime=<value>

    - BaselineTimestamp=<value>

    3) If the query returns no rows, ask whether to write AvgResponseTime=NA and
    BaselineTimestamp=NA or to abort. If authentication or resource access fails, ask for corrected
    credentials or resource details.


  tools:
    - QueryAppInsightsByAppId
    - UploadKnowledgeDocument
  handoff_description: Use this to calculate the AvgResponseTime
  agent_type: Autonomous
